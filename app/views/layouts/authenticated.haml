%html
  %head
    %title PhotoROUTE
    = stylesheet_link_tag 'photoroute'
    -# Helper doesn't like qs params
    %script{'type' => 'text/javascript', 'src' => 'http://maps.google.com/maps/api/js?sensor=false'}
    %script{'type' => 'text/javascript'}
      window.coords = [];
      - if @path
        - @path.path_waypoints.each do |pp|
          - latlng = pp.waypoint.latlng.split(',')
          = "window.coords.push(new google.maps.LatLng(#{latlng[0]},#{latlng[1]}));"
    :javascript
      function initialize() {
        var myOptions = {
          zoom: 8,
          center: window.coords[0],
          mapTypeId: google.maps.MapTypeId.ROADMAP
        };

        var map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);

        for (i=0;i<=window.coords.length-1;i++) {
          marker = new google.maps.Marker({position: window.coords[i], map: map, title:"marker"});
        };

        var flightPath = new google.maps.Polyline({
          path: window.coords,
          strokeColor: "#FF0000",
          strokeOpacity: 1.0,
          strokeWeight: 3
        });
        flightPath.setMap(map);
      }
  %body#store{'onload' => 'initialize()'}
    #banner<
      = image_tag 'logo.jpg', :size => '50x40'
      = @page_title || 'PhotoROUTE'
    #columns
      #side
        %a Home
        %br/
        %a FAQ
        %br/
        %a News
        %br/
        %a Contact
        %br/
      #main
        - for name in [:notice, :warning, :message, :error, :alert] 
          - if flash[name]
            %div{:id => name.to_s, 'class' => 'rails-notice'}= flash[name]
        = yield :layout